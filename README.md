# 🚀 A股量化投研系统 - 股票归因分析 + 多因子选股 + 自动交易


**一套完整的A股量化投研系统，涵盖股票风格分类、归因分析、多因子选股与自动交易**

---

## � 系统意义

### 🎯 核心理念：基本面约束 + 量价信号 = 高信噪比Alpha

传统量化策略往往面临两大困境：
1. **纯技术面策略**：容易受市场情绪和噪音干扰，信噪比低，难以持续盈利
2. **纯基本面策略**：反应滞后，错失最佳交易时机，执行效率低

本系统创新性地将**基本面筛选**与**量价分析**深度融合，构建了一套"先定性、后定量"的投研框架：

### 🔍 三层递进式筛选机制

#### 第一层：基本面风格分类（降低Beta暴露）
- 通过**财务因子**（PE/PB/ROE/增速）进行股票风格分类
- 区分**成长股**（高估值+高增长）与**价值股**（低估值+稳定ROE）
- **目的**：在同质化的股票池内进行横截面比较，降低市场Beta暴露，提高Alpha纯度

#### 第二层：文本信息挖掘（捕捉真实经营动态）
- 结合**券商研报**与**公司公告纪要**进行语义解读
- 通过**LLM**提取公司真实经营举措、战略调整、行业变化等关键信息
- **目的**：挖掘财务数据背后的业务逻辑，识别真正的基本面改善信号

#### 第三层：量价因子精选（高频信号捕捉）
- 在基本面筛选后的股票池内，使用**120个Alpha因子**进行量价分析
- **20个专门的回撤控制因子**，在追求收益的同时严控风险
- **目的**：在基本面约束的框架下，通过量价信号捕捉最佳交易时机

### 📊 系统优势

#### ✅ 信噪比提升
- **基本面过滤**：剔除基本面恶化的股票，避免"价值陷阱"
- **同质化比较**：在风格相似的股票池内比较，减少风格因子干扰
- **结果**：模型在股票池内产生**稳定的横截面超额收益**（vs沪深300 +55.46%）

#### ✅ 可解释性增强
- **随机森林归因**：识别涨跌关键财务因子
- **LLM文本解读**：生成自然语言归因报告
- **结果**：每一笔交易都有清晰的基本面+技术面双重支撑

#### ✅ 风险控制优化
- **Beta约束**：通过基本面分类降低市场Beta暴露
- **回撤因子**：20个专门的下行风险控制因子
- **结果**：夏普比率2.74，最大回撤仅15.90%

### 🎓 理论基础

本系统的设计理念源于现代量化投资的核心思想：

```
总收益 = Alpha（超额收益） + Beta（市场收益）

传统策略问题：
- 纯技术面：Alpha信号弱，噪音大
- 纯基本面：Beta暴露高，时机把握差

本系统解决方案：
1. 基本面分类 → 降低Beta暴露 → 提高Alpha纯度
2. 文本挖掘 → 捕捉真实信号 → 减少噪音干扰
3. 量价精选 → 优化交易时机 → 提升执行效率

最终结果：
在控制Beta暴露的前提下，获取稳定的横截面Alpha收益
```

---
---

## 📋 项目概述

本项目构建了一套完整的A股量化投研系统，实现了从基本面分析到量化交易的全流程：

### 🎯 三大核心模块

#### 📊 模块一：股票风格分类与归因分析（年频数据）
- **基于财务因子**（PE/PB/ROE/增速等）的股票风格分类
- **随机森林归因分析**，识别涨跌关键因素
- **LLM语义解读**，结合研报公告生成可解释的涨跌归因
- **四象限分析**：成长股/价值股 × 上涨/下跌

#### 📈 模块二：选股验证分析（季频数据）
- 季度财务数据驱动的选股框架
- 基于ROE、增速、现金流等指标的综合评分
- 结合文本信息的AI选股解释

#### 💹 模块三：多因子量化交易系统（日频数据）
- **120个Alpha因子** + **LightGBM模型**
- 滚动训练机制，严格防止未来信息泄露
- T-1信号T日执行的回测框架
- 集成QMT/PTrade自动交易链路

---

## 🎯 功能特性

### ✨ 核心亮点

- **📊 多维度分析**：年频/季频/日频数据全覆盖
- **🤖 AI驱动**：LightGBM + LLM双引擎
- **🔒 严格回测**：防止未来信息泄露，T-1信号T日执行
- **⚡ 自动交易**：支持QMT/PTrade/BigQuant多平台
- **📈 可解释性**：随机森林归因 + LLM文本解读
- **🎨 可视化**：完整的回测图表与持仓分析

### 🛠️ 技术栈

- **机器学习**：LightGBM, RandomForest, Scikit-learn
- **数据处理**：Pandas, NumPy
- **可视化**：Matplotlib, Seaborn
- **数据库**：MySQL, SQLAlchemy
- **交易接口**：QMT, PTrade, BigQuant

---

## 📊 性能表现

### 模块三：多因子量化交易系统

<div align="center">

| 指标 | 数值 | 说明 |
|:---:|:---:|:---|
| **策略总收益** | 83.30% | 2025年5-12月测试期 |
| **超额收益(vs沪深300)** | 55.46% | 显著跑赢基准 |
| **夏普比率** | 2.74 | 风险调整后收益优秀 |
| **最大回撤** | 15.90% | 回撤控制良好 |
| **Calmar比率** | 6.65 | 收益回撤比优秀 |
| **测试区间** | 2025年5月-12月 | 年报披露后测试 |

</div>

### 📈 策略优势

✅ **超额收益稳定**：在基本面与文本信息约束β暴露后，模型在股票池内产生稳定的横截面超额收益  
✅ **风险控制优秀**：20个专门的回撤控制因子，最大回撤控制在16%以内  
✅ **IC指标良好**：Train/Valid/Test IC均 > 0.02，ICIR > 0.5  
✅ **实盘可用**：严格的T-1信号T日执行框架，无前视偏差

---

## 🏗️ 系统架构

### 📂 项目结构

```
stock-quant-system/
│
├── 📊 模块一：股票归因分析（年频）
│   ├── 归因分析+股票回测.ipynb      # 主分析流程
│   └── 选股分析.docx                # 分析报告
│
├── 📈 模块二：选股验证（季频）
│   └── clean.ipynb                  # 季度数据分析
│
├── 💹 模块三：多因子交易（日频）
│   ├── run_daily.py                 # 一键运行脚本 ⭐
│   ├── multi_factor_model.py        # 主模型（训练+回测）
│   ├── alpha_factors.py             # 120个Alpha因子引擎
│   ├── extract_portfolio.py         # 提取股票池（首次用）
│   ├── update_portfolio.py          # 更新数据（备用）
│   ├── visualize_trades.py          # 持仓可视化
│   │
│   ├── 🤖 自动交易
│   │   ├── auto_trade.py            # QMT自动交易
│   │   ├── ptrade_strategy_*.py     # PTrade策略
│   │   ├── config_ptrade.py         # PTrade配置
│   │   └── test_ptrade_strategy.py  # 策略测试
│   │
│   └── 📄 数据文件
│       ├── portfolio 2020-2025.12.csv  # 历史数据
│       ├── latest_signal.csv           # 最新信号
│       └── *.png                       # 可视化图表
│
└── 📚 文档
    ├── README.md                    # 本文件
    ├── DEPLOY_GUIDE.md              # 部署指南
    ├── README_PTRADE.md             # PTrade文档
    ├── PTRADE_QUICK_START.md        # 快速开始
    └── SUMMARY.md                   # 项目总结
```

---

## 📖 详细说明

### 📊 模块一：股票归因分析（年频数据）

#### 核心流程

```
1. 数据准备
   ├── 年度财务样本构建（每年4月30日后首个交易日）
   ├── 市值过滤（剔除底部30%小盘股）
   └── ROE三年滚动均值与波动率

2. 风格分类
   ├── 成长股：高估值 + 高增长（PE高、净利润增速高）
   ├── 价值股：低估值 + 稳定ROE（PE低、ROE波动小）
   └── 其他股票

3. 归因分析
   ├── 相对收益计算（vs中证全指）
   ├── 极端样本选取（涨跌幅前50）
   ├── 随机森林因子重要性评估
   └── LLM自然语言解释（结合研报+财务数据）

4. 多维度分析
   └── 行业 × 风格 × 涨跌 三维交叉分析
```

#### 关键特性

- ✅ **四象限分析**：成长股上涨/下跌、价值股上涨/下跌
- ✅ **因子归因**：随机森林识别关键财务因子
- ✅ **文本解读**：LLM结合研报公告生成可解释归因
- ✅ **行业对比**：申万一级行业维度分析

---

### 📈 模块二：选股验证分析（季频数据）

#### 核心流程

```
1. 季度财务样本构建（以3月31日为基准）
2. 提取季度同比增速（净利润、营收、研发、现金流）
3. 季度ROE均值与波动计算
4. 财务宽表拼接 + 清洗
5. AI生成选股解释（结合文本与因子）
```

#### 关键指标

- 净利润同比增速
- 营收同比增速
- 研发投入强度
- 经营现金流
- ROE稳定性

---

### 💹 模块三：多因子量化交易系统（日频数据）

#### 🎯 策略核心

##### 1. 因子体系（120个Alpha因子）

<details>
<summary><b>📌 点击展开因子分类</b></summary>

**精简原始因子（40个）**
- 趋势/动量类：ADX、波动率、收益率偏度、均线位置
- 成交量类：成交量比、量价相关性、MFI资金流
- 价格形态类：影线、通道位置、布林带
- 技术指标类：RSI、KDJ、ATR

**逻辑差异化因子（60个）**
- 换手率因子：换手率异常、加速度、稳定性
- 价格形态因子：缺口、实体占比、连续阳线
- 资金流因子：OBV、Chaikin、大单推测
- 波动率结构因子：期限结构、聚集性、Parkinson
- 相对强弱因子：威廉指标、CCI、ADX
- 时序特征因子：自相关性、持续性、峰度
- 量价关系因子：相关性变化、背离强度、同步性

**回撤控制因子（20个）**
- 下行风险因子：最大回撤、回撤恢复速度、下行波动率
- 尾部风险因子：负偏度、超额峰度、大跌频率
- 波动率状态因子：波动率分位数、趋势、稳定性
- 防御性因子：Beta代理、价格稳定性、抗跌能力
- 风险调整收益：夏普比率、Sortino比率、Calmar比率

</details>

##### 2. 模型训练策略

```python
# 数据集划分
训练集：2020-2023年（4年历史数据）
验证集：2024年 + 2025年1-4月（调参用）
测试集：2025年5月后（年报披露后）

# 模型配置
算法：LightGBM Regression
目标：预测未来5天收益
特征：120个Alpha因子
```

##### 3. 调仓策略

```

##### 4. 防止未来信息泄露

```python

# 回测执行
T-1日收盘后：计算因子，生成信号
T日尾盘：执行调仓（无前视偏差）
```

#### 🤖 自动交易

##### 方案：PTrade
---


## ⚠️ 风险提示

### 重要声明

- ⚠️ **历史表现不代表未来**：策略基于历史数据，不保证未来收益
- ⚠️ **市场风险**：市场环境变化可能导致策略失效
---


## 📄 许可证

本项目因涉及收益问题，仅提供部分思路供学习和研究使用，不构成投资建议。

使用本项目进行实盘交易的风险由使用者自行承担。


</div>
